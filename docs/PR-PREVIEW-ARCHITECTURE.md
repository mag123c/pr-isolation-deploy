# PR Preview í™˜ê²½ ì•„í‚¤í…ì²˜ ì˜ì‚¬ê²°ì • ë¬¸ì„œ

> ì‘ì„±ì¼: 2025-12-15
> ëª©ì : PRë³„ ê²©ë¦¬ëœ Preview í™˜ê²½ êµ¬ì¶•ì„ ìœ„í•œ ì•„í‚¤í…ì²˜ ë¶„ì„ ë° ì˜ì‚¬ê²°ì •

---

## 1. ë¬¸ì œ ì •ì˜

### 1.1 í˜„ì¬ ìƒí™© (link-client ê¸°ì¤€)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     í˜„ì¬ ë°°í¬ êµ¬ì¡°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  feature/* â”€â”€â”                                              â”‚
â”‚  bugfix/*  â”€â”€â”¼â”€â”€> develop â”€â”€> link-dev (ë‹¨ì¼ í™˜ê²½)           â”‚
â”‚  hotfix/*  â”€â”€â”˜                                              â”‚
â”‚                                                             â”‚
â”‚  master â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> link-prod                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê¸°ì¡´ link-client ë°°í¬ íŒŒì´í”„ë¼ì¸:**
- GitHub Actions â†’ ECR â†’ ECS (Fargate) â†’ CodeDeploy (Blue/Green)
- í´ëŸ¬ìŠ¤í„°: `link-dev`, `link-prod`
- ì„œë¹„ìŠ¤: `web-creator`

### 1.2 ë¬¸ì œì 

| ë¬¸ì œ | ì„¤ëª… | ì˜í–¥ |
|------|------|------|
| **ë‹¨ì¼ Dev í™˜ê²½ ë³‘ëª©** | ì—¬ëŸ¬ ê¸°ëŠ¥ì´ ë™ì‹œì— developì— ë¨¸ì§€ë˜ë©´ ì¶©ëŒ | QA ì§€ì—° |
| **ìˆœì°¨ì  ë°°í¬ ëŒ€ê¸°** | A ê¸°ëŠ¥ QA ì¤‘ B ê¸°ëŠ¥ì€ ëŒ€ê¸° í•„ìš” | ê°œë°œ ì†ë„ ì €í•˜ |
| **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë¹„ìš©** | "ì§€ê¸ˆ dev ì“°ê³  ìˆì–´ìš”" ìŠ¬ë™ ë©”ì‹œì§€ | í˜‘ì—… íš¨ìœ¨ ì €í•˜ |
| **ë¡¤ë°± ë³µì¡ì„±** | ì—¬ëŸ¬ ê¸°ëŠ¥ì´ ì„ì¸ ìƒíƒœì—ì„œ íŠ¹ì • ê¸°ëŠ¥ë§Œ ë¡¤ë°± ì–´ë ¤ì›€ | ì¥ì•  ëŒ€ì‘ ì§€ì—° |

---

## 2. ì†”ë£¨ì…˜ ë¹„êµ ë¶„ì„

### 2.1 ì¸í”„ë© ë°©ì‹ (K8s + Service Mesh)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ì¸í”„ë© ì•„í‚¤í…ì²˜                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PR + preview ë¼ë²¨                                          â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Argo CD ApplicationSet â”€â”€> Helm Chart â”€â”€> K8s Pod         â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Linkerd HTTPRoute (ì¿ í‚¤: pr=101)                           â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  ê°™ì€ URL, ì¿ í‚¤ë¡œ ë¼ìš°íŒ… ë¶„ê¸°                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì :**
- URL ë¶ˆë³€ (ì¿ í‚¤ë¡œ ë¶„ê¸°)
- Backend ë³€ê²½ ë¶ˆí•„ìš”
- GitOps ê¸°ë°˜ ìë™í™”

**ë‹¨ì :**
- K8s í´ëŸ¬ìŠ¤í„° í•„ìˆ˜ (EKS ë¹„ìš© ~$70/ì›”)
- Linkerd Service Mesh ë„ì… í•„ìš”
- ì´ˆê¸° êµ¬ì¶• ë³µì¡ë„ ë†’ìŒ
- ì¿ í‚¤ ì„¤ì • í•„ìš” (ë¸Œë¼ìš°ì € í™•ì¥ or ê°œë°œìë„êµ¬)

**ë¹„ìš© (ì›”ê°„ ì¶”ì •):**
```
EKS Control Plane: $72
Worker Node (t3.medium x2): $60
ALB: $20
ì´: ~$152/ì›” (ê¸°ë³¸ ì¸í”„ë¼ë§Œ)
```

### 2.2 Vercel ë°©ì‹ (PaaS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel ì•„í‚¤í…ì²˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PR ìƒì„±                                                    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Vercel ìë™ ê°ì§€ â”€â”€> ìë™ ë°°í¬                              â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  pr-123-project.vercel.app (ê³ ìœ  URL)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì :**
- ì œë¡œ ì¸í”„ë¼ ê´€ë¦¬
- ì¦‰ì‹œ ì ìš© ê°€ëŠ¥
- ìë™ HTTPS

**ë‹¨ì :**
- ë„ë©”ì¸ ë³€ê²½ìœ¼ë¡œ CORS/ì¿ í‚¤ ì´ìŠˆ
- Backend API ìˆ˜ì • í•„ìš” (ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)
- ë²¤ë” ë½ì¸
- í”„ë¡ íŠ¸ì—”ë“œë§Œ í•´ë‹¹

**ë¹„ìš©:**
```
Pro Plan: $20/user/ì›”
Enterprise: í˜‘ì˜
```

### 2.3 AWS ECS + ALB Host ë¼ìš°íŒ… (êµ¬í˜„ëœ ë°©ì‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  êµ¬í˜„ëœ ì•„í‚¤í…ì²˜ (preview-test)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PR opened/synchronize                                      â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  GitHub Actions                                             â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â”€> ECR (ì´ë¯¸ì§€ ë¹Œë“œ/í‘¸ì‹œ)                            â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â”€> Target Group ìƒì„± (pr-{N}-tg)                    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â”€> ALB Rule ì¶”ê°€ (Host: pr-{N}.domain.com)          â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€â”€> ECS Service ìƒì„± (pr-{N})                        â”‚
â”‚                                                             â”‚
â”‚  PR closed â”€â”€> ëª¨ë“  ë¦¬ì†ŒìŠ¤ ìë™ ì‚­ì œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì :**
- ê¸°ì¡´ ECS ì¸í”„ë¼ì™€ ë™ì¼í•œ íŒ¨í„´
- ë„ë©”ì¸ íŒ¨í„´ ìœ ì§€ (`pr-*.ounwan.net`)
- Backend ë³€ê²½ ë¶ˆí•„ìš”
- ì¸í”„ë¼ ì½”ë“œ ì¬ì‚¬ìš© ê°€ëŠ¥
- ì™„ì „ ìë™í™” (ìƒì„±/ì‚­ì œ)

**ë‹¨ì :**
- PRë§ˆë‹¤ ALB Rule ì¶”ê°€ (ìµœëŒ€ 100ê°œ ì œí•œ)
- ë§¤ë²ˆ ì»¨í…Œì´ë„ˆ ê¸°ë™ ì‹œê°„ (~30ì´ˆ)
- ECR ì´ë¯¸ì§€ ëˆ„ì  ê´€ë¦¬ í•„ìš”

**ë¹„ìš© (PR 5ê°œ ìš´ì˜ ê¸°ì¤€):**
```
ALB: $20/ì›” (ê³ ì •)
ECS Fargate (256 CPU, 512MB x 5): ~$15/ì›”
ECR: ~$1/ì›”
Route53: $0.50/ì›”
ì´: ~$37/ì›”
```

---

## 3. ë¹„ìš© ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤

| ë°©ì‹ | ì´ˆê¸° êµ¬ì¶• | ì›” ìš´ì˜ë¹„ | í™•ì¥ì„± | ë³µì¡ë„ |
|------|----------|----------|--------|--------|
| **ì¸í”„ë© (K8s)** | ë†’ìŒ | ~$150+ | ë†’ìŒ | ë†’ìŒ |
| **Vercel** | ì—†ìŒ | $20/user | ì œí•œì  | ë‚®ìŒ |
| **ECS+ALB (í˜„ì¬)** | ì¤‘ê°„ | ~$37 | ì¤‘ê°„ | ì¤‘ê°„ |

---

## 4. í˜„ì¬ êµ¬í˜„ ìƒì„¸ ë¶„ì„

### 4.1 ì›Œí¬í”Œë¡œìš° êµ¬ì¡°

```yaml
# pr-preview-deploy.yml
on:
  pull_request:
    types: [opened, synchronize]
    branches: [main]

# í•µì‹¬ ë‹¨ê³„:
# 1. ECR ë¡œê·¸ì¸ ë° ì´ë¯¸ì§€ ë¹Œë“œ
# 2. Target Group ìƒì„±/ì¡°íšŒ (ë©±ë“±ì„±)
# 3. ALB Rule ì¶”ê°€ (Host ê¸°ë°˜ ë¼ìš°íŒ…)
# 4. ECS Service ìƒì„±/ì—…ë°ì´íŠ¸
# 5. PR ì½”ë©˜íŠ¸ë¡œ URL ì•ˆë‚´
```

```yaml
# pr-preview-cleanup.yml
on:
  pull_request:
    types: [closed]

# ì •ë¦¬ ìˆœì„œ:
# 1. ECS Service ì‚­ì œ
# 2. ALB Rule ì‚­ì œ
# 3. Target Group ì‚­ì œ
# 4. Task Definition ë“±ë¡ í•´ì œ
```

### 4.2 ë©±ë“±ì„± ë³´ì¥

```bash
# Target Group - ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì¬ì‚¬ìš©
TG_ARN=$(aws elbv2 describe-target-groups --names pr-${N}-tg ... || echo "")
if [ -z "$TG_ARN" ]; then
  # ìƒˆë¡œ ìƒì„±
fi

# ECS Service - ì¡´ì¬í•˜ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ìƒì„±
SERVICE_STATUS=$(aws ecs describe-services ... || echo "MISSING")
if [ "$SERVICE_STATUS" == "ACTIVE" ]; then
  aws ecs update-service --force-new-deployment
else
  aws ecs create-service
fi
```

### 4.3 ë¦¬ì†ŒìŠ¤ ë„¤ì´ë° ì»¨ë²¤ì…˜

| ë¦¬ì†ŒìŠ¤ | ë„¤ì´ë° íŒ¨í„´ | ì˜ˆì‹œ |
|--------|------------|------|
| ECR ì´ë¯¸ì§€ íƒœê·¸ | `pr-{N}` | `pr-123` |
| Target Group | `pr-{N}-tg` | `pr-123-tg` |
| ECS Service | `pr-{N}` | `pr-123` |
| Task Definition | `pr-{N}-web` | `pr-123-web` |
| ë„ë©”ì¸ | `pr-{N}.domain.com` | `pr-123.ounwan.net` |

---

## 5. link-client ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­

### 5.1 ê¸°ì¡´ ì¸í”„ë¼ì™€ì˜ ì°¨ì´ì 

| í•­ëª© | link-client (ê¸°ì¡´) | preview-test (ì‹ ê·œ) |
|------|-------------------|---------------------|
| ë°°í¬ ë„êµ¬ | CodeDeploy (B/G) | ì§ì ‘ ECS API |
| Task Def | AWS ì½˜ì†”ì—ì„œ ê´€ë¦¬ | ì›Œí¬í”Œë¡œìš°ì—ì„œ ë™ì  ìƒì„± |
| í™˜ê²½ ìˆ˜ | ê³ ì • (dev/prod) | ë™ì  (PR ìˆ˜ë§Œí¼) |
| í´ëŸ¬ìŠ¤í„° | link-dev, link-prod | preview-cluster2 |

### 5.2 ì ìš© ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê¶Œì¥ ì ìš© ì „ëµ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Phase 1: ë³„ë„ Preview í´ëŸ¬ìŠ¤í„° ìš´ì˜                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  link-dev (ê¸°ì¡´) â—„â”€â”€ develop ë¸Œëœì¹˜                   â”‚  â”‚
â”‚  â”‚  preview-cluster â—„â”€â”€ PR Preview                      â”‚  â”‚
â”‚  â”‚  link-prod (ê¸°ì¡´) â—„â”€â”€ master ë¸Œëœì¹˜                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Phase 2: í†µí•© (ì„ íƒì )                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  preview-cluster â—„â”€â”€ PR Preview + develop í†µí•©        â”‚  â”‚
â”‚  â”‚  link-prod (ê¸°ì¡´) â—„â”€â”€ master ë¸Œëœì¹˜                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. 100ë…„ì°¨ DevOps ì—”ì§€ë‹ˆì–´ ê´€ì : ìµœì¢… ì„¤ê³„ ê¶Œì¥ì•ˆ

### 6.1 í˜„ì‹¤ì  ì œì•½ ì¡°ê±´

1. **ì˜ˆì‚°**: ìŠ¤íƒ€íŠ¸ì—…/ì¤‘ì†Œê¸°ì—… ìˆ˜ì¤€ (~$50/ì›” ì´í•˜)
2. **ì¸ë ¥**: ì „ë‹´ DevOps ì—”ì§€ë‹ˆì–´ ë¶€ì¬
3. **ê¸°ìˆ  ìŠ¤íƒ**: ì´ë¯¸ ECS ì‚¬ìš© ì¤‘
4. **ì‹œê°„**: ë¹ ë¥¸ ì ìš© í•„ìš”

### 6.2 ë‹¨ê¸° ê¶Œì¥ì•ˆ (í˜„ì¬ êµ¬í˜„)

```
âœ… í˜„ì¬ êµ¬í˜„ëœ ë°©ì‹ ìœ ì§€
   - ECS Fargate + ALB Host ë¼ìš°íŒ…
   - PRë³„ ë…ë¦½ í™˜ê²½ ìë™ ìƒì„±/ì‚­ì œ
   - ë¹„ìš©: ~$37/ì›”
```

**ê°œì„  í¬ì¸íŠ¸:**

1. **ECR ì´ë¯¸ì§€ ì •ë¦¬ ìë™í™”**
```yaml
# pr-preview-cleanup.ymlì— ì¶”ê°€
- name: Delete ECR image
  run: |
    aws ecr batch-delete-image \
      --repository-name preview-web \
      --image-ids imageTag=pr-${{ github.event.number }}
```

2. **ALB Rule ì œí•œ ëŒ€ì‘**
```yaml
# 100ê°œ ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ Preview ìë™ ì‚­ì œ
# ë˜ëŠ” Scheduled cleanup (7ì¼ ì´ìƒ ëœ í™˜ê²½)
```

3. **ë¹„ìš© ìµœì í™”: Spot Fargate**
```json
{
  "capacityProviderStrategy": [{
    "capacityProvider": "FARGATE_SPOT",
    "weight": 1
  }]
}
// ~70% ë¹„ìš© ì ˆê° ê°€ëŠ¥
```

### 6.3 ì¤‘ê¸° ë°œì „ì•ˆ (ëª¨ë…¸ë ˆí¬ ëŒ€ì‘)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ëª¨ë…¸ë ˆí¬ PR Preview ì•„í‚¤í…ì²˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  monorepo/                                                  â”‚
â”‚  â”œâ”€â”€ apps/                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ web-creator/     â”€â”€> pr-{N}-creator.domain.com    â”‚
â”‚  â”‚   â”œâ”€â”€ web-admin/       â”€â”€> pr-{N}-admin.domain.com      â”‚
â”‚  â”‚   â””â”€â”€ api-gateway/     â”€â”€> pr-{N}-api.domain.com        â”‚
â”‚  â””â”€â”€ packages/            (ê³µìœ  íŒ¨í‚¤ì§€)                      â”‚
â”‚                                                             â”‚
â”‚  ë³€ê²½ ê°ì§€ â”€â”€> ì˜í–¥ë°›ëŠ” ì•±ë§Œ ì„ íƒì  ë°°í¬                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ë°©ì‹:**
```yaml
jobs:
  detect-changes:
    outputs:
      web-creator: ${{ steps.filter.outputs.web-creator }}
      web-admin: ${{ steps.filter.outputs.web-admin }}
    steps:
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            web-creator:
              - 'apps/web-creator/**'
              - 'packages/**'
            web-admin:
              - 'apps/web-admin/**'
              - 'packages/**'

  deploy-creator:
    needs: detect-changes
    if: needs.detect-changes.outputs.web-creator == 'true'
    # ... ê¸°ì¡´ ë°°í¬ ë¡œì§
```

### 6.4 ì¥ê¸° ë°œì „ì•ˆ (ê·œëª¨ í™•ëŒ€ ì‹œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ëŒ€ê·œëª¨ í™•ì¥ ì‹œ ì•„í‚¤í…ì²˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ì˜µì…˜ A: EKS + Argo CD                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - K8s ê¸°ë°˜ìœ¼ë¡œ ì „í™˜                                   â”‚  â”‚
â”‚  â”‚  - Argo CD ApplicationSet ë„ì…                        â”‚  â”‚
â”‚  â”‚  - ì¸í”„ë© ë°©ì‹ ì°¸ê³                                     â”‚  â”‚
â”‚  â”‚  - ì¡°ê±´: ê°œë°œì 10ëª…+, ì›” $200+ ì˜ˆì‚°                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  ì˜µì…˜ B: AWS App Runner                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - ECSë³´ë‹¤ ê°„ë‹¨í•œ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤                        â”‚  â”‚
â”‚  â”‚  - ìë™ ìŠ¤ì¼€ì¼ë§ ë‚´ì¥                                  â”‚  â”‚
â”‚  â”‚  - ë¹„ìš©: vCPU/ì‹œê°„, ë©”ëª¨ë¦¬/ì‹œê°„ ê³¼ê¸ˆ                   â”‚  â”‚
â”‚  â”‚  - ì¡°ê±´: ë‹¨ìˆœí•œ ì•±, ë¹ ë¥¸ í™•ì¥ í•„ìš”                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ê²°ë¡  ë° ì•¡ì…˜ ì•„ì´í…œ

### 7.1 ì˜ì‚¬ê²°ì • ìš”ì•½

| ì§ˆë¬¸ | ê²°ì • | ê·¼ê±° |
|------|------|------|
| K8s vs ECS? | **ECS** | ê¸°ì¡´ ì¸í”„ë¼, ë‚®ì€ ë³µì¡ë„, ë¹„ìš© |
| Vercel vs Self-hosted? | **Self-hosted** | CORS ì´ìŠˆ íšŒí”¼, ê¸°ì¡´ ë„ë©”ì¸ ìœ ì§€ |
| CodeDeploy vs Direct API? | **Direct API** | PreviewëŠ” B/G ë¶ˆí•„ìš”, ë‹¨ìˆœí™” |
| ë³„ë„ í´ëŸ¬ìŠ¤í„° vs ê¸°ì¡´ í™œìš©? | **ë³„ë„ í´ëŸ¬ìŠ¤í„°** | ê²©ë¦¬, ë¹„ìš© ì¶”ì  ìš©ì´ |

### 7.2 ì¦‰ì‹œ ì•¡ì…˜ ì•„ì´í…œ

- [x] Preview í´ëŸ¬ìŠ¤í„° ìƒì„± (`preview-cluster2`)
- [x] ì™€ì¼ë“œì¹´ë“œ ì¸ì¦ì„œ ë°œê¸‰ (`*.ounwan.net`)
- [x] ALB + Route53 ì„¤ì •
- [x] GitHub Actions ì›Œí¬í”Œë¡œìš° êµ¬í˜„
- [x] í…ŒìŠ¤íŠ¸ PRë¡œ ê²€ì¦ ì™„ë£Œ (PR #9, #10)
- [ ] link-clientì— ì›Œí¬í”Œë¡œìš° ì ìš©
- [ ] ECR ì´ë¯¸ì§€ ìë™ ì •ë¦¬ ì¶”ê°€
- [ ] Fargate Spot ì ìš© ê²€í† 

### 7.3 ëª¨ë‹ˆí„°ë§ ì§€í‘œ

```
ğŸ“Š ì¶”ì í•´ì•¼ í•  ë©”íŠ¸ë¦­:
- Preview í™˜ê²½ ìƒì„± ì‹œê°„ (ëª©í‘œ: < 3ë¶„)
- ì›”ê°„ Preview í™˜ê²½ ìƒì„± ìˆ˜
- ì‹¤íŒ¨ìœ¨ (ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨)
- ì›”ê°„ ë¹„ìš© (ëª©í‘œ: < $50)
```

---

## ë¶€ë¡ A: ë¹„ìš© ìƒì„¸ ê³„ì‚°

### Fargate ë¹„ìš© (ap-northeast-2)

```
vCPU: $0.04656/ì‹œê°„
ë©”ëª¨ë¦¬: $0.00511/GB/ì‹œê°„

Preview í™˜ê²½ 1ê°œ (256 vCPU, 512MB):
- vCPU: 0.25 * $0.04656 = $0.01164/ì‹œê°„
- ë©”ëª¨ë¦¬: 0.5 * $0.00511 = $0.00256/ì‹œê°„
- í•©ê³„: $0.0142/ì‹œê°„ = $10.22/ì›” (24x7)

ì‹¤ì œ ìš´ì˜ (ì—…ë¬´ì‹œê°„ 10ì‹œê°„/ì¼, ì£¼5ì¼):
- ì›” 200ì‹œê°„ = $2.84/í™˜ê²½/ì›”
```

### ì´ ë¹„ìš© ì˜ˆì¸¡

| í•­ëª© | 5 PR | 10 PR | 20 PR |
|------|------|-------|-------|
| ALB | $20 | $20 | $20 |
| Fargate | $15 | $30 | $60 |
| ECR | $1 | $2 | $4 |
| Route53 | $0.5 | $0.5 | $0.5 |
| **ì´í•©** | **$36.5** | **$52.5** | **$84.5** |

---

## ë¶€ë¡ B: íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 503 ì—ëŸ¬
- **ì›ì¸**: ì»¨í…Œì´ë„ˆ ê¸°ë™ ì¤‘ (~30ì´ˆ)
- **í•´ê²°**: 30ì´ˆ í›„ ì¬ì‹œë„

### ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨
- **LISTENER_ARN ì˜¤ë¥˜**: ALB ARNì´ ì•„ë‹Œ Listener ARN í™•ì¸
- **í´ëŸ¬ìŠ¤í„° Not Found**: ECS_CLUSTER í™˜ê²½ë³€ìˆ˜ í™•ì¸
- **ê¶Œí•œ ì˜¤ë¥˜**: IAM Roleì— ecs:*, elbv2:*, ecr:* ê¶Œí•œ í™•ì¸

### ALB Rule 100ê°œ ì œí•œ
- ì˜¤ë˜ëœ Preview ìˆ˜ë™ ì •ë¦¬
- Scheduled cleanup ì›Œí¬í”Œë¡œìš° ì¶”ê°€ ê¶Œì¥
